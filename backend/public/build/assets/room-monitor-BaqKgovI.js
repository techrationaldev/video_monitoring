import{c as A,j as t,H,a}from"./app-RTcY-n5c.js";import{A as U}from"./app-layout-jlA_Hse4.js";import{l as B}from"./index-BCtBPRNr.js";import{a as R}from"./app-logo-icon-B_501DtH.js";import{R as F}from"./refresh-cw-Ca_ABoIy.js";/* empty css            */import"./index-CmeQD44-.js";import"./index-BNkOUdRb.js";import"./index-C4J_hXM0.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],q=R("MicOff",_);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],G=R("Mic",Z);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Q=R("VideoOff",K);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Y=R("Video",X);function V(d){const r=A.c(6),{track:l,controls:f,muted:u}=d,m=f===void 0?!0:f,c=u===void 0?!0:u,i=a.useRef(null);let p,g;r[0]!==l?(p=()=>{if(i.current&&l){const b=new MediaStream([l]);i.current.srcObject=b,i.current.play().catch(console.error)}},g=[l],r[0]=l,r[1]=p,r[2]=g):(p=r[1],g=r[2]),a.useEffect(p,g);let v;return r[3]!==m||r[4]!==c?(v=t.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:c,controls:m,className:"h-full w-full object-cover"}),r[3]=m,r[4]=c,r[5]=v):v=r[5],v}function ee(d){const r=A.c(5),{track:l,muted:f}=d,u=a.useRef(null);let m,c;r[0]!==l?(m=()=>{if(u.current&&l){const p=new MediaStream([l]);u.current.srcObject=p,u.current.play().catch(console.error)}},c=[l],r[0]=l,r[1]=m,r[2]=c):(m=r[1],c=r[2]),a.useEffect(m,c);let i;return r[3]!==f?(i=t.jsx("audio",{ref:u,autoPlay:!0,muted:f}),r[3]=f,r[4]=i):i=r[4],i}function pe(d){const r=A.c(8),{roomId:l}=d;let f;r[0]===Symbol.for("react.memo_cache_sentinel")?(f=[{title:"Room Monitor",href:"#"}],r[0]=f):f=r[0];const u=`Monitor Room ${l}`;let m;r[1]!==u?(m=t.jsx(H,{title:u}),r[1]=u,r[2]=m):m=r[2];let c;r[3]!==l?(c=t.jsx(te,{roomId:l}),r[3]=l,r[4]=c):c=r[4];let i;return r[5]!==m||r[6]!==c?(i=t.jsxs(U,{breadcrumbs:f,children:[m,c]}),r[5]=m,r[6]=c,r[7]=i):i=r[7],i}function te({roomId:d,variant:r="full"}){a.useEffect(()=>{console.log("[ADMIN] RoomMonitor v2.1 loaded")},[]);const[l,f]=a.useState([]),[u,m]=a.useState(null),c=l.reduce((e,n)=>(e[n.clientId]||(e[n.clientId]={clientId:n.clientId}),n.kind==="video"&&(e[n.clientId].video=n),n.kind==="audio"&&(e[n.clientId].audio=n),e),{}),i=a.useRef(null),p=a.useRef(null),g=a.useRef(null),v=a.useRef(new Map),b=a.useRef([]),y=a.useRef("");if(!y.current){const e=sessionStorage.getItem(`mediasoup-client-id-${d}`);if(e)y.current=e;else{const n=crypto.randomUUID();sessionStorage.setItem(`mediasoup-client-id-${d}`,n),y.current=n}}const[w,D]=a.useState("disconnected"),[re,ne]=a.useState(!1),[I,E]=a.useState({}),[N,L]=a.useState({}),[T,O]=a.useState(!1);a.useEffect(()=>{let e=null,n;const o=()=>{const s="wss://eyeserver.mytro.in";e=new WebSocket(s),p.current=e,e.onopen=()=>{console.log("[ADMIN] Connected to Mediasoup Server"),D("connected");const h={action:"join-as-viewer",roomId:d,clientId:y.current};console.log("[ADMIN] Sending join-as-viewer:",h),e?.send(JSON.stringify(h))},e.onmessage=async h=>{const M=JSON.parse(h.data),{action:k,data:x}=M;switch(console.log(`[ADMIN] WS RECV: ${k}`,x),k){case"router-rtp-capabilities":await P(x),e?.send(JSON.stringify({action:"create-recv-transport",roomId:d,clientId:y.current}));break;case"create-recv-transport":await W(x);break;case"existing-producers":for(const j of x)S(j.id,j.clientId);break;case"new-producer":S(x.producerId,x.clientId);break;case"producer-closed":f(j=>j.filter(C=>C.producerId!==x.producerId));break;case"consume-done":await z(x);break;case"transport-connected":break;case"restart-ice-done":await J(x);break;case"session-ended":console.warn("[ADMIN] Session ended by server, reloading..."),window.location.reload();break;case"stream-interrupted":console.warn("[ADMIN] Stream interrupted (network drop?)"),O(!0);break}},e.onclose=()=>{console.log("[ADMIN] WS Closed, reconnecting in 3s..."),D("reconnecting"),g.current&&(g.current.close(),g.current=null),n=setTimeout(o,3e3)},e.onerror=h=>{console.error("[ADMIN] WS Error:",h),e?.close()}};return o(),()=>{e&&(e.onclose=null,e.close()),clearTimeout(n),i.current=null,g.current=null,v.current=new Map,b.current=[],f([])}},[d]);const P=async e=>{try{const n=new B.Device;await n.load({routerRtpCapabilities:e}),i.current=n,console.log("Device loaded")}catch(n){console.error("Failed to load device:",n)}},W=async e=>{const n=i.current;if(!n)return;const o=n.createRecvTransport(e);if(g.current=o,o.on("connect",({dtlsParameters:s},h,M)=>{p.current?.send(JSON.stringify({action:"connect-transport",roomId:d,clientId:y.current,data:{transportId:o.id,dtlsParameters:s}})),h()}),o.on("connectionstatechange",s=>{console.log(`[ADMIN] Recv Transport connection state changed: ${s}`),s==="connected"||(s==="disconnected"||s==="failed")&&(console.warn("[ADMIN] Transport disconnected or failed; closing WS to trigger reconnect."),o.close(),g.current=null,p.current&&p.current.readyState===WebSocket.OPEN&&p.current.close())}),b.current.length>0){console.log(`Processing ${b.current.length} pending producers`);for(const{producerId:s,clientId:h}of b.current)S(s,h);b.current=[]}},S=(e,n)=>{const o=i.current,s=g.current;if(!o||!s){console.warn("Device or transport not ready to consume, queueing producer",e),b.current.push({producerId:e,clientId:n});return}const h=o.rtpCapabilities;p.current?.send(JSON.stringify({action:"consume",roomId:d,clientId:y.current,data:{transportId:s.id,producerId:e,rtpCapabilities:h,appData:{clientId:n}}})),$.current.set(e,n)},$=a.useRef(new Map),z=async e=>{const{id:n,producerId:o,kind:s,rtpParameters:h}=e,M=$.current.get(o)||"unknown",k=g.current;if(!k)return;const x=await k.consume({id:n,producerId:o,kind:s,rtpParameters:h});v.current.set(x.id,x),new MediaStream().addTrack(x.track),f(C=>[...C,{id:x.id,producerId:o,kind:s,track:x.track,clientId:M}]),O(!1),console.log(`Consuming ${s} from producer ${o}`)},J=async e=>{const{transportId:n,iceParameters:o}=e,s=g.current;s&&s.id===n&&(console.log("[ADMIN] Restarting ICE with new parameters"),await s.restartIce({iceParameters:o}))};return console.log("RoomMonitor variant:",r),r==="card"?t.jsx("div",{className:"h-full w-full bg-black",children:Object.keys(c).length===0?t.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-gray-500 border-t-white"}),t.jsx("span",{className:"text-xs",children:"Connecting..."})]})}):t.jsx("div",{className:`grid h-full w-full ${Object.keys(c).length>1?"grid-cols-2":"grid-cols-1"}`,children:Object.values(c).map(e=>t.jsxs("div",{className:"relative h-full w-full overflow-hidden",children:[e.video?t.jsx(V,{track:e.video.track,controls:!1,muted:!0}):t.jsx("div",{className:"flex h-full items-center justify-center bg-gray-900 text-white",children:"No Video"}),t.jsx("div",{className:"absolute top-2 right-2 flex flex-col gap-2 opacity-0 transition-opacity group-hover:opacity-100",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{const o=!(I[e.clientId]||!1);E(s=>({...s,[e.clientId]:o})),p.current?.send(JSON.stringify({action:"admin-action",roomId:d,targetClientId:e.clientId,actionType:o?"mute-audio":"unmute-audio"}))},className:`rounded p-1.5 text-white ${I[e.clientId]?"bg-red-500/80":"bg-black/50 hover:bg-black/70"}`,title:I[e.clientId]?"Unmute Remote Mic":"Mute Remote Mic",children:I[e.clientId]?t.jsx(q,{size:16}):t.jsx(G,{size:16})}),t.jsx("button",{onClick:()=>{const o=!(N[e.clientId]||!1);L(s=>({...s,[e.clientId]:o})),p.current?.send(JSON.stringify({action:"admin-action",roomId:d,targetClientId:e.clientId,actionType:o?"mute-video":"unmute-video"}))},className:`rounded p-1.5 text-white ${N[e.clientId]?"bg-red-500/80":"bg-black/50 hover:bg-black/70"}`,title:N[e.clientId]?"Enable Remote Camera":"Disable Remote Camera",children:N[e.clientId]?t.jsx(Q,{size:16}):t.jsx(Y,{size:16})}),t.jsx("button",{onClick:()=>{confirm("Force reload remote client?")&&p.current?.send(JSON.stringify({action:"admin-action",roomId:d,targetClientId:e.clientId,actionType:"reload"}))},className:"rounded bg-black/50 p-1.5 text-white hover:bg-red-600/80",title:"Force Reload Remote Client",children:t.jsx(F,{size:16})})]})}),t.jsx("div",{className:"absolute bottom-2 left-2 rounded bg-black/60 px-1.5 py-0.5 text-[10px] text-white backdrop-blur-sm",children:e.clientId.slice(0,6)})]},e.clientId))})}):t.jsxs("div",{className:"h-full p-6",children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Room:"," ",t.jsx("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:d})]}),t.jsx("span",{className:`rounded-full px-3 py-1 text-sm font-medium ${w==="connected"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":w==="reconnecting"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:w==="connected"?"Active":w==="reconnecting"?"Reconnecting...":"Disconnected"})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[Object.keys(c).length===0&&t.jsxs("div",{className:"col-span-full flex h-64 flex-col items-center justify-center rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-700 dark:bg-gray-800/50 dark:text-gray-400",children:[t.jsx("div",{className:"mb-4 h-12 w-12 animate-pulse rounded-full bg-gray-200 dark:bg-gray-700"}),t.jsx("p",{className:"text-lg font-medium",children:"Waiting for streams..."}),t.jsx("p",{className:"text-sm",children:"Streams will appear here automatically"})]}),Object.values(c).map(e=>t.jsxs("div",{className:`overflow-hidden rounded-xl bg-white shadow-lg ring-1 transition-all ${u===e.clientId?"ring-2 shadow-blue-500/20 ring-blue-500":"ring-gray-200 dark:ring-gray-700"} dark:bg-gray-800`,onClick:()=>m(e.clientId===u?null:e.clientId),children:[t.jsxs("div",{className:"group relative aspect-video cursor-pointer bg-black",children:[e.video?t.jsx(V,{track:e.video.track,muted:!0}):t.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("svg",{className:"h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),t.jsx("span",{children:"No Video"})]})}),e.audio&&t.jsx(ee,{track:e.audio.track,muted:u!==e.clientId}),t.jsx("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:t.jsxs("span",{className:"rounded bg-black/60 px-2 py-1 font-mono text-xs text-white backdrop-blur-sm",children:["ID: ",e.clientId.slice(0,8)]})}),t.jsx("div",{className:"absolute top-3 right-3",children:t.jsx("div",{className:`rounded-full p-2 backdrop-blur-sm transition-colors ${u===e.clientId?"bg-blue-500 text-white":"bg-black/40 text-white/70 group-hover:bg-black/60"}`,children:u===e.clientId?t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}):t.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})})}),T&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:t.jsxs("div",{className:"flex flex-col items-center gap-2 text-yellow-500",children:[t.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-yellow-500 border-t-transparent"}),t.jsx("span",{className:"font-bold",children:"Reconnecting..."})]})})]}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Client ",e.clientId.slice(0,4)]}),t.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.video&&t.jsx("span",{className:"text-green-500",children:"Video"}),e.audio&&t.jsx("span",{className:"text-blue-500",children:"Audio"})]})]})})]},e.clientId))]})]})}export{te as RoomMonitor,pe as default};
