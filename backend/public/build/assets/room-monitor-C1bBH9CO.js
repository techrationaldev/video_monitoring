import{c as w,j as e,H as S,a as x}from"./app-D7BEmhhi.js";import{A as M}from"./app-layout-_TO2LaPK.js";import{l as D}from"./index-BCtBPRNr.js";/* empty css            */import"./app-logo-icon-BSVBqvSZ.js";import"./index-Dl7UzVWL.js";import"./index-CeBZkVq-.js";import"./index-C4J_hXM0.js";function H(u){const r=w.c(8),{roomId:n}=u;let m;r[0]===Symbol.for("react.memo_cache_sentinel")?(m=[{title:"Room Monitor",href:"#"}],r[0]=m):m=r[0];const i=`Monitor Room ${n}`;let c;r[1]!==i?(c=e.jsx(S,{title:i}),r[1]=i,r[2]=c):c=r[2];let a;r[3]!==n?(a=e.jsx(P,{roomId:n}),r[3]=n,r[4]=a):a=r[4];let d;return r[5]!==c||r[6]!==a?(d=e.jsxs(M,{breadcrumbs:m,children:[c,a]}),r[5]=c,r[6]=a,r[7]=d):d=r[7],d}function P({roomId:u,variant:r="full"}){const[n,m]=x.useState([]),i=x.useRef(null),c=x.useRef(null),a=x.useRef(null),d=x.useRef(new Map),p=x.useRef([]),h=x.useRef(crypto.randomUUID());x.useEffect(()=>{const t="wss://eyeserver.mytro.in",s=new WebSocket(t);return c.current=s,s.onopen=()=>{console.log("Connected to Mediasoup Server"),s.send(JSON.stringify({action:"join-as-viewer",roomId:u,clientId:h.current}))},s.onmessage=async o=>{const l=JSON.parse(o.data),{action:b,data:f}=l;switch(b){case"router-rtp-capabilities":await N(f),s.send(JSON.stringify({action:"create-recv-transport",roomId:u,clientId:h.current}));break;case"create-recv-transport":await k(f);break;case"existing-producers":for(const g of f)v(g.id);break;case"new-producer":v(f.producerId);break;case"producer-closed":m(g=>g.filter(j=>j.producerId!==f.producerId));break;case"consume-done":await R(f);break}},()=>{s.close()}},[u]);const N=async t=>{try{const s=new D.Device;await s.load({routerRtpCapabilities:t}),i.current=s,console.log("Device loaded")}catch(s){console.error("Failed to load device:",s)}},k=async t=>{const s=i.current;if(!s)return;const o=s.createRecvTransport(t);if(a.current=o,o.on("connect",({dtlsParameters:l},b,f)=>{c.current?.send(JSON.stringify({action:"connect-transport",roomId:u,clientId:h.current,data:{transportId:o.id,dtlsParameters:l}})),b()}),o.on("connectionstatechange",l=>{console.log("[ADMIN] Recv Transport connection state changed:",l)}),console.log("Recv Transport created"),p.current.length>0){console.log(`Processing ${p.current.length} pending producers`);for(const l of p.current)v(l);p.current=[]}},v=t=>{const s=i.current,o=a.current;if(!s||!o){console.warn("Device or transport not ready to consume, queueing producer",t),p.current.push(t);return}const l=s.rtpCapabilities;c.current?.send(JSON.stringify({action:"consume",roomId:u,clientId:h.current,data:{transportId:o.id,producerId:t,rtpCapabilities:l}}))},R=async t=>{const{id:s,producerId:o,kind:l,rtpParameters:b}=t,f=a.current;if(!f)return;const g=await f.consume({id:s,producerId:o,kind:l,rtpParameters:b});d.current.set(g.id,g),new MediaStream().addTrack(g.track),m(I=>[...I,{id:g.id,producerId:o,track:g.track}]),console.log(`Consuming ${l} from producer ${o}`)};return console.log("RoomMonitor variant:",r),r==="card"?e.jsx("div",{className:"h-full w-full bg-black",children:n.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-gray-500 border-t-white"}),e.jsx("span",{className:"text-xs",children:"Connecting..."})]})}):e.jsx("div",{className:`grid h-full w-full ${n.length>1?"grid-cols-2":"grid-cols-1"}`,children:n.map(t=>e.jsxs("div",{className:"relative h-full w-full overflow-hidden",children:[e.jsx(y,{track:t.track,controls:!1}),e.jsx("div",{className:"absolute bottom-2 left-2 rounded bg-black/60 px-1.5 py-0.5 text-[10px] text-white backdrop-blur-sm",children:t.producerId.slice(0,6)})]},t.id))})}):e.jsxs("div",{className:"h-full p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Room:"," ",e.jsx("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:u})]}),e.jsx("span",{className:"rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800 dark:bg-green-900 dark:text-green-200",children:"Active"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[n.length===0&&e.jsxs("div",{className:"col-span-full flex h-64 flex-col items-center justify-center rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-700 dark:bg-gray-800/50 dark:text-gray-400",children:[e.jsx("div",{className:"mb-4 h-12 w-12 animate-pulse rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsx("p",{className:"text-lg font-medium",children:"Waiting for streams..."}),e.jsx("p",{className:"text-sm",children:"Streams will appear here automatically"})]}),n.map(t=>e.jsxs("div",{className:"overflow-hidden rounded-xl bg-white shadow-lg ring-1 ring-gray-200 dark:bg-gray-800 dark:ring-gray-700",children:[e.jsxs("div",{className:"relative aspect-video bg-black",children:[e.jsx(y,{track:t.track}),e.jsx("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:e.jsxs("span",{className:"rounded bg-black/60 px-2 py-1 font-mono text-xs text-white backdrop-blur-sm",children:["ID: ",t.producerId.slice(0,8)]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-red-500"})]})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Live Stream"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Video"})]})})]},t.id))]})]})}const y=u=>{const r=w.c(5),{track:n,controls:m}=u,i=m===void 0?!0:m,c=x.useRef(null);let a,d;r[0]!==n?(a=()=>{if(c.current&&n){const h=new MediaStream([n]);c.current.srcObject=h,c.current.play().catch(console.error)}},d=[n],r[0]=n,r[1]=a,r[2]=d):(a=r[1],d=r[2]),x.useEffect(a,d);let p;return r[3]!==i?(p=e.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,muted:!0,controls:i,className:"h-full w-full object-cover"}),r[3]=i,r[4]=p):p=r[4],p};export{P as RoomMonitor,H as default};
