import{c as y,j as e,H as I,a as x}from"./app-DhgR-8R5.js";import{A as S}from"./app-layout-BJMg3z87.js";import{l as M}from"./index-BCtBPRNr.js";/* empty css            */import"./app-logo-icon-CNYTzWtm.js";import"./index-BM50GUpp.js";import"./index-jhMtcVcA.js";import"./index-C4J_hXM0.js";function L(d){const r=y.c(8),{roomId:s}=d;let u;r[0]===Symbol.for("react.memo_cache_sentinel")?(u=[{title:"Room Monitor",href:"#"}],r[0]=u):u=r[0];const l=`Monitor Room ${s}`;let c;r[1]!==l?(c=e.jsx(I,{title:l}),r[1]=l,r[2]=c):c=r[2];let n;r[3]!==s?(n=e.jsx(D,{roomId:s}),r[3]=s,r[4]=n):n=r[4];let i;return r[5]!==c||r[6]!==n?(i=e.jsxs(S,{breadcrumbs:u,children:[c,n]}),r[5]=c,r[6]=n,r[7]=i):i=r[7],i}function D({roomId:d,variant:r="full"}){const[s,u]=x.useState([]),l=x.useRef(null),c=x.useRef(null),n=x.useRef(null),i=x.useRef(new Map),m=x.useRef([]),b=x.useRef(crypto.randomUUID());x.useEffect(()=>{const t=new WebSocket("ws://localhost:5005");return c.current=t,t.onopen=()=>{console.log("Connected to Mediasoup Server"),t.send(JSON.stringify({action:"join-as-viewer",roomId:d,clientId:b.current}))},t.onmessage=async a=>{const o=JSON.parse(a.data),{action:p,data:f}=o;switch(p){case"router-rtp-capabilities":await w(f),t.send(JSON.stringify({action:"create-recv-transport",roomId:d,clientId:b.current}));break;case"create-recv-transport":await k(f);break;case"existing-producers":for(const g of f)v(g.id);break;case"new-producer":v(f.producerId);break;case"producer-closed":u(g=>g.filter(h=>h.producerId!==f.producerId));break;case"consume-done":await N(f);break}},()=>{t.close()}},[d]);const w=async t=>{try{const a=new M.Device;await a.load({routerRtpCapabilities:t}),l.current=a,console.log("Device loaded")}catch(a){console.error("Failed to load device:",a)}},k=async t=>{const a=l.current;if(!a)return;const o=a.createRecvTransport(t);if(n.current=o,o.on("connect",({dtlsParameters:p},f,g)=>{c.current?.send(JSON.stringify({action:"connect-transport",roomId:d,clientId:b.current,data:{transportId:o.id,dtlsParameters:p}})),f()}),console.log("Recv Transport created"),m.current.length>0){console.log(`Processing ${m.current.length} pending producers`);for(const p of m.current)v(p);m.current=[]}},v=t=>{const a=l.current,o=n.current;if(!a||!o){console.warn("Device or transport not ready to consume, queueing producer",t),m.current.push(t);return}const p=a.rtpCapabilities;c.current?.send(JSON.stringify({action:"consume",roomId:d,clientId:b.current,data:{transportId:o.id,producerId:t,rtpCapabilities:p}}))},N=async t=>{const{id:a,producerId:o,kind:p,rtpParameters:f}=t,g=n.current;if(!g)return;const h=await g.consume({id:a,producerId:o,kind:p,rtpParameters:f});i.current.set(h.id,h),new MediaStream().addTrack(h.track),u(R=>[...R,{id:h.id,producerId:o,track:h.track}]),console.log(`Consuming ${p} from producer ${o}`)};return console.log("RoomMonitor variant:",r),r==="card"?e.jsx("div",{className:"h-full w-full bg-black",children:s.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-gray-500 border-t-white"}),e.jsx("span",{className:"text-xs",children:"Connecting..."})]})}):e.jsx("div",{className:`grid h-full w-full ${s.length>1?"grid-cols-2":"grid-cols-1"}`,children:s.map(t=>e.jsxs("div",{className:"relative h-full w-full overflow-hidden",children:[e.jsx(j,{track:t.track,controls:!1}),e.jsx("div",{className:"absolute bottom-2 left-2 rounded bg-black/60 px-1.5 py-0.5 text-[10px] text-white backdrop-blur-sm",children:t.producerId.slice(0,6)})]},t.id))})}):e.jsxs("div",{className:"h-full p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Room:"," ",e.jsx("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:d})]}),e.jsx("span",{className:"rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800 dark:bg-green-900 dark:text-green-200",children:"Active"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[s.length===0&&e.jsxs("div",{className:"col-span-full flex h-64 flex-col items-center justify-center rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-700 dark:bg-gray-800/50 dark:text-gray-400",children:[e.jsx("div",{className:"mb-4 h-12 w-12 animate-pulse rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsx("p",{className:"text-lg font-medium",children:"Waiting for streams..."}),e.jsx("p",{className:"text-sm",children:"Streams will appear here automatically"})]}),s.map(t=>e.jsxs("div",{className:"overflow-hidden rounded-xl bg-white shadow-lg ring-1 ring-gray-200 dark:bg-gray-800 dark:ring-gray-700",children:[e.jsxs("div",{className:"relative aspect-video bg-black",children:[e.jsx(j,{track:t.track}),e.jsx("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:e.jsxs("span",{className:"rounded bg-black/60 px-2 py-1 font-mono text-xs text-white backdrop-blur-sm",children:["ID: ",t.producerId.slice(0,8)]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-red-500"})]})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Live Stream"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Video"})]})})]},t.id))]})]})}const j=d=>{const r=y.c(5),{track:s,controls:u}=d,l=u===void 0?!0:u,c=x.useRef(null);let n,i;r[0]!==s?(n=()=>{if(c.current&&s){const b=new MediaStream([s]);c.current.srcObject=b,c.current.play().catch(console.error)}},i=[s],r[0]=s,r[1]=n,r[2]=i):(n=r[1],i=r[2]),x.useEffect(n,i);let m;return r[3]!==l?(m=e.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,muted:!0,controls:l,className:"h-full w-full object-cover"}),r[3]=l,r[4]=m):m=r[4],m};export{D as RoomMonitor,L as default};
