import{c as w,j as e,H as S,a as x}from"./app-GKcxN27_.js";import{A as M}from"./app-layout-CRGF4l-6.js";import{l as D}from"./index-BCtBPRNr.js";/* empty css            */import"./app-logo-icon-C6vQYVob.js";import"./index-t30D3_Mr.js";import"./index-Oy4ddPCg.js";import"./index-C4J_hXM0.js";function H(d){const r=w.c(8),{roomId:c}=d;let u;r[0]===Symbol.for("react.memo_cache_sentinel")?(u=[{title:"Room Monitor",href:"#"}],r[0]=u):u=r[0];const l=`Monitor Room ${c}`;let n;r[1]!==l?(n=e.jsx(S,{title:l}),r[1]=l,r[2]=n):n=r[2];let a;r[3]!==c?(a=e.jsx(P,{roomId:c}),r[3]=c,r[4]=a):a=r[4];let i;return r[5]!==n||r[6]!==a?(i=e.jsxs(M,{breadcrumbs:u,children:[n,a]}),r[5]=n,r[6]=a,r[7]=i):i=r[7],i}function P({roomId:d,variant:r="full"}){const[c,u]=x.useState([]),l=x.useRef(null),n=x.useRef(null),a=x.useRef(null),i=x.useRef(new Map),m=x.useRef([]),h=x.useRef(crypto.randomUUID());x.useEffect(()=>{const t="wss://eyeserver.mytro.in",s=new WebSocket(t);return n.current=s,s.onopen=()=>{console.log("Connected to Mediasoup Server"),s.send(JSON.stringify({action:"join-as-viewer",roomId:d,clientId:h.current}))},s.onmessage=async o=>{const p=JSON.parse(o.data),{action:b,data:f}=p;switch(b){case"router-rtp-capabilities":await k(f),s.send(JSON.stringify({action:"create-recv-transport",roomId:d,clientId:h.current}));break;case"create-recv-transport":await N(f);break;case"existing-producers":for(const g of f)v(g.id);break;case"new-producer":v(f.producerId);break;case"producer-closed":u(g=>g.filter(j=>j.producerId!==f.producerId));break;case"consume-done":await R(f);break}},()=>{s.close()}},[d]);const k=async t=>{try{const s=new D.Device;await s.load({routerRtpCapabilities:t}),l.current=s,console.log("Device loaded")}catch(s){console.error("Failed to load device:",s)}},N=async t=>{const s=l.current;if(!s)return;const o=s.createRecvTransport(t);if(a.current=o,o.on("connect",({dtlsParameters:p},b,f)=>{n.current?.send(JSON.stringify({action:"connect-transport",roomId:d,clientId:h.current,data:{transportId:o.id,dtlsParameters:p}})),b()}),console.log("Recv Transport created"),m.current.length>0){console.log(`Processing ${m.current.length} pending producers`);for(const p of m.current)v(p);m.current=[]}},v=t=>{const s=l.current,o=a.current;if(!s||!o){console.warn("Device or transport not ready to consume, queueing producer",t),m.current.push(t);return}const p=s.rtpCapabilities;n.current?.send(JSON.stringify({action:"consume",roomId:d,clientId:h.current,data:{transportId:o.id,producerId:t,rtpCapabilities:p}}))},R=async t=>{const{id:s,producerId:o,kind:p,rtpParameters:b}=t,f=a.current;if(!f)return;const g=await f.consume({id:s,producerId:o,kind:p,rtpParameters:b});i.current.set(g.id,g),new MediaStream().addTrack(g.track),u(I=>[...I,{id:g.id,producerId:o,track:g.track}]),console.log(`Consuming ${p} from producer ${o}`)};return console.log("RoomMonitor variant:",r),r==="card"?e.jsx("div",{className:"h-full w-full bg-black",children:c.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-gray-500 border-t-white"}),e.jsx("span",{className:"text-xs",children:"Connecting..."})]})}):e.jsx("div",{className:`grid h-full w-full ${c.length>1?"grid-cols-2":"grid-cols-1"}`,children:c.map(t=>e.jsxs("div",{className:"relative h-full w-full overflow-hidden",children:[e.jsx(y,{track:t.track,controls:!1}),e.jsx("div",{className:"absolute bottom-2 left-2 rounded bg-black/60 px-1.5 py-0.5 text-[10px] text-white backdrop-blur-sm",children:t.producerId.slice(0,6)})]},t.id))})}):e.jsxs("div",{className:"h-full p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Room:"," ",e.jsx("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:d})]}),e.jsx("span",{className:"rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800 dark:bg-green-900 dark:text-green-200",children:"Active"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[c.length===0&&e.jsxs("div",{className:"col-span-full flex h-64 flex-col items-center justify-center rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-700 dark:bg-gray-800/50 dark:text-gray-400",children:[e.jsx("div",{className:"mb-4 h-12 w-12 animate-pulse rounded-full bg-gray-200 dark:bg-gray-700"}),e.jsx("p",{className:"text-lg font-medium",children:"Waiting for streams..."}),e.jsx("p",{className:"text-sm",children:"Streams will appear here automatically"})]}),c.map(t=>e.jsxs("div",{className:"overflow-hidden rounded-xl bg-white shadow-lg ring-1 ring-gray-200 dark:bg-gray-800 dark:ring-gray-700",children:[e.jsxs("div",{className:"relative aspect-video bg-black",children:[e.jsx(y,{track:t.track}),e.jsx("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:e.jsxs("span",{className:"rounded bg-black/60 px-2 py-1 font-mono text-xs text-white backdrop-blur-sm",children:["ID: ",t.producerId.slice(0,8)]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-red-500"})]})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Live Stream"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Video"})]})})]},t.id))]})]})}const y=d=>{const r=w.c(5),{track:c,controls:u}=d,l=u===void 0?!0:u,n=x.useRef(null);let a,i;r[0]!==c?(a=()=>{if(n.current&&c){const h=new MediaStream([c]);n.current.srcObject=h,n.current.play().catch(console.error)}},i=[c],r[0]=c,r[1]=a,r[2]=i):(a=r[1],i=r[2]),x.useEffect(a,i);let m;return r[3]!==l?(m=e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,controls:l,className:"h-full w-full object-cover"}),r[3]=l,r[4]=m):m=r[4],m};export{P as RoomMonitor,H as default};
